# Enterprise Customer Rewards System (Legacy)

This is a legacy Java web application for managing customer rewards, built with JSP/Servlets and Maven.

## Deployment Instructions

1. **Build the Application**
   - Run the following command in the project root:
     ```sh
     mvn clean package
     ```
   - The WAR file will be generated at `target/enterprise-customer-rewards-system.war`.

2. **Deploy to Tomcat 8**
   - Copy the WAR file to the `webapps` directory of your Tomcat 8 installation.
   - Start or restart Tomcat.

3. **Configure Tomcat Users and Roles**
   - Edit `conf/tomcat-users.xml` in your Tomcat installation.
   - Add users and roles as below (roles used: `admin`, `user`):
     ```xml
     <tomcat-users>
       <role rolename="admin"/>
       <role rolename="user"/>
       <user username="admin" password="adminpass" roles="admin"/>
       <user username="customer" password="custpass" roles="user"/>
     </tomcat-users>
     ```

4. **Database Configuration**
   - Create a MySQL database and user.
   - Run the `init.sql` script to initialize tables and sample data:
     ```sh
     mysql -u <dbuser> -p <dbname> < init.sql
     ```
   - Update `src/main/resources/db.properties` with your DB connection details.

## API Usage Examples

### Get All Customers
```sh
curl -u admin:admin@123 http://18.188.144.133:8080/enterprise-customer-rewards-system/service/customers
```
**Sample Output (XML):**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<customers>
  <count>2</count>
  <customer>
    <customerId>CUST001234</customerId>
    <firstName>Sarah</firstName>
    <lastName>Johnson</lastName>
    <emailAddress>sarah.johnson@email.com</emailAddress>
    <phoneNumber>555-0123</phoneNumber>
    <registrationDate>2025-07-24 11:36:45.0</registrationDate>
    <loyaltyTier>GOLD</loyaltyTier>
    <totalLifetimePoints>325</totalLifetimePoints>
    <currentAvailablePoints>325</currentAvailablePoints>
    <accountStatus>ACTIVE</accountStatus>
  </customer>
  <customer>
    <customerId>CUST001235</customerId>
    <firstName>Mike</firstName>
    <lastName>Davis</lastName>
    <emailAddress>mike.davis@email.com</emailAddress>
    <phoneNumber>555-0124</phoneNumber>
    <registrationDate>2025-07-24 11:36:45.0</registrationDate>
    <loyaltyTier>SILVER</loyaltyTier>
    <totalLifetimePoints>75</totalLifetimePoints>
    <currentAvailablePoints>75</currentAvailablePoints>
    <accountStatus>ACTIVE</accountStatus>
  </customer>
</customers>
```



### Create Customer
```sh
curl -u admin:admin@123 -X POST \
  -H "Content-Type: application/xml" \
  -d '<?xml version="1.0" encoding="UTF-8"?>
<customer>
  <firstName>Alice</firstName>
  <lastName>Williams</lastName>
  <emailAddress>alice.williams@email.com</emailAddress>
  <phoneNumber>555-0125</phoneNumber>
  <registrationDate>2025-07-26 13:00:00.0</registrationDate>
  <loyaltyTier>BRONZE</loyaltyTier>
  <totalLifetimePoints>0</totalLifetimePoints>
  <currentAvailablePoints>0</currentAvailablePoints>
  <accountStatus>ACTIVE</accountStatus>
</customer>' \
  http://18.188.144.133:8080/enterprise-customer-rewards-system/service/customers
```

**Note:** The `customerId` is now always generated by the backend and will be returned in the response. Do not include `customerId` in the POST body.

**Sample Output (XML):**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<customer>
  <customerId>CUST528857085149</customerId>
  <firstName>Alice</firstName>
  <lastName>Williams</lastName>
  <emailAddress>alice.williams@email.com</emailAddress>
  <phoneNumber>555-0125</phoneNumber>
  <registrationDate>2025-07-26 11:20:57.0</registrationDate>
  <loyaltyTier>BRONZE</loyaltyTier>
  <totalLifetimePoints>0</totalLifetimePoints>
  <currentAvailablePoints>0</currentAvailablePoints>
  <accountStatus>ACTIVE</accountStatus>
</customer>
```

### Get a Particular Customer
```sh
curl -u admin:admin@123 "http://18.188.144.133:8080/enterprise-customer-rewards-system/service/customers?customerId=CUST001234"
```
**Sample Output (XML):**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<customer>
  <customerId>CUST001234</customerId>
  <firstName>Sarah</firstName>
  <lastName>Johnson</lastName>
  <emailAddress>sarah.johnson@email.com</emailAddress>
  <phoneNumber>555-0123</phoneNumber>
  <registrationDate>2025-07-24 11:36:45.0</registrationDate>
  <loyaltyTier>GOLD</loyaltyTier>
  <totalLifetimePoints>325</totalLifetimePoints>
  <currentAvailablePoints>325</currentAvailablePoints>
  <accountStatus>ACTIVE</accountStatus>
</customer>
```

### Get All Transactions
```sh
curl -u admin:admin@123 http://18.188.144.133:8080/enterprise-customer-rewards-system/service/transactions
```
**Sample Output (XML):**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<transactions>
  <count>2</count>
  <transaction>
    <transactionId>TXN0001</transactionId>
    <customerId>CUST001234</customerId>
    <transactionDate>2025-07-25 10:15:00.0</transactionDate>
    <transactionType>EARN</transactionType>
    <points>100</points>
    <description>Signup bonus</description>
    <status>COMPLETED</status>
  </transaction>
  <transaction>
    <transactionId>TXN0002</transactionId>
    <customerId>CUST001235</customerId>
    <transactionDate>2025-07-25 11:00:00.0</transactionDate>
    <transactionType>REDEEM</transactionType>
    <points>50</points>
    <description>Reward redemption</description>
    <status>COMPLETED</status>
  </transaction>
</transactions>
```

### Create Transaction
```sh
curl -u admin:admin@123 -X POST \
  -H "Content-Type: application/xml" \
  -d '<?xml version="1.0" encoding="UTF-8"?>
<transaction>
  <customerId>CUST001234</customerId>
  <transactionDate>2025-07-26 12:00:00.0</transactionDate>
  <transactionType>ADJUST</transactionType>
  <points>200</points>
  <description>Manual adjustment</description>
</transaction>' \
  http://18.188.144.133:8080/enterprise-customer-rewards-system/service/transactions
```

---

**Note:** The API returns XML only, not JSON.

For more details, refer to the source code and comments. This README provides only the essential steps and API usage for quick setup and testing.
